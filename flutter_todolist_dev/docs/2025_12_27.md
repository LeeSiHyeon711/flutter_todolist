# 변경사항 정리

## 기준 커밋: `a973c49` [review] 2차 리뷰끝

---

## 1. `657e47c` [feat] add_access_token
**날짜**: 2025-12-23

### 변경된 파일
- `lib/provider/schedule_provider.dart`
- `lib/repository/schedule_repository.dart`
- `lib/screen/home_screen.dart`
- `lib/component/schedule_bottom_sheet.dart`

### 주요 변경사항

#### ScheduleRepository
- **Firestore → REST API로 변경**
  - `cloud_firestore` 패키지 제거
  - `dio` 패키지 사용하여 REST API 호출로 전환
  - API 엔드포인트: `http://localhost:3000/schedule` (Android는 `10.0.2.2`)
  - 모든 메서드에 `accessToken` 파라미터 추가
  - `getSchedules()`: GET 요청으로 변경, Authorization 헤더 추가
  - `createSchedule()`: POST 요청으로 변경, 반환 타입 `String?`로 변경
  - `deleteSchedule()`: DELETE 요청으로 변경, 파라미터 순서 변경 (`accessToken` 먼저)

#### ScheduleProvider
- `getSchedules()` 메서드 추가 (accessToken 파라미터 포함)
- `createSchedule()` 메서드에 `accessToken` 파라미터 추가
- `deleteSchedule()` 메서드에 `accessToken` 파라미터 추가

#### HomeScreen
- `StatelessWidget` → `StatefulWidget`으로 변경
- `selectedDate` 상태 변수 추가
- `initState()`에서 오늘 날짜 일정 자동 로드
- `StreamBuilder` 제거, Provider의 cache 사용
- `onDaySelected()`에서 `provider.getSchedules()` 호출로 변경
- 일정 삭제 시 `provider.deleteSchedule()` 사용

---

## 2. `0da76d4` [feat] google_login
**날짜**: 2025-12-24

### 변경된 파일
- `lib/main.dart`
- `lib/screen/auth_login_screen.dart` (신규 생성)
- `pubspec.yaml` (의존성 추가)
- Firebase 설정 파일들 (GoogleService-Info.plist, google-services.json)
- iOS/macOS 프로젝트 설정 파일들

### 주요 변경사항

#### AuthLoginScreen (신규)
- 구글 로그인 화면 구현
- `google_sign_in` 패키지 사용
- Firebase Auth와 연동
- 로그인 성공 시 `HomeScreen`으로 이동
- 에러 처리 및 SnackBar 표시

#### main.dart
- `AuthScreen` → `AuthLoginScreen`으로 초기 화면 변경

#### 의존성 추가
- `google_sign_in` 패키지 추가

#### 플랫폼별 설정
- iOS: Info.plist, Runner.entitlements 설정
- macOS: GoogleService-Info.plist, entitlements 설정
- Android: google-services.json 업데이트

---

## 3. `4fb644f` [faet] firebase_backend_finish
**날짜**: 2025-12-24

### 변경된 파일
- `lib/screen/home_screen.dart`
- `lib/component/schedule_bottom_sheet.dart`
- `lib/component/today_banner.dart`
- `ios/Podfile.lock` (대량 삭제)

### 주요 변경사항

#### HomeScreen
- **Provider 기반 → Firestore StreamBuilder로 전환**
  - Provider의 cache 사용 중단
  - `FirebaseFirestore.instance.collection('schedule')` 직접 사용
  - `StreamBuilder<QuerySnapshot>` 사용하여 실시간 업데이트
  - `where('author', isEqualTo: FirebaseAuth.instance.currentUser!.email)` 필터 추가
  - `initState()` 제거
  - `selectedDate` 상태 관리 방식 변경

#### ScheduleBottomSheet
- 일정 생성 시 `FirebaseFirestore.instance.collection('schedule').doc().set()` 직접 호출
- `author` 필드 추가 (현재 사용자 이메일)
- `FirebaseAuth.instance.currentUser` 확인 로직 추가
- Provider를 통한 일정 생성 로직 제거

#### TodayBanner
- Provider cache 대신 StreamBuilder의 docs.length 사용

---

## 4. `59d4c91` [change] changed_chrome
**날짜**: 2025-12-26

### 변경된 파일
- `lib/main.dart`
- `lib/repository/auth_repository.dart`
- `lib/repository/schedule_repository.dart`
- `lib/screen/auth_login_screen.dart`
- `lib/screen/home_screen.dart`
- `web/index.html`
- iOS/macOS 프로젝트 설정 파일들

### 주요 변경사항

#### main.dart
- **전역 에러 핸들링 추가**
  - `runZonedGuarded`로 앱 전체 예외 처리
  - `FlutterError.onError` 설정
  - `PlatformDispatcher.instance.onError` 설정
- **macOS 플랫폼 특화 처리**
  - Firebase Auth persistence 비활성화 (`Persistence.NONE`)
  - Google Sign-In 이전 세션 정리 (`googleSignIn.signOut()`)
  - `kIsWeb`, `defaultTargetPlatform` 체크 추가
- **에러 화면 추가**
  - Firebase 초기화 실패 시 에러 화면 표시

#### AuthRepository
- `Platform.isAndroid` → `_getHost()` 메서드로 변경
- 웹 플랫폼 지원 추가 (`kIsWeb` 체크)
- `defaultTargetPlatform` 사용

#### ScheduleRepository
- `Platform.isAndroid` → `_getHost()` 메서드로 변경
- 웹 플랫폼 지원 추가 (`kIsWeb` 체크)
- `defaultTargetPlatform` 사용

#### AuthLoginScreen
- **웹 플랫폼 지원 강화**
  - 웹용 Google OAuth Client ID 설정
  - 웹에서 `['email', 'profile', 'openid']` scope 사용
  - People API 오류 처리 추가
  - `idToken` null 허용 처리
- **에러 처리 개선**
  - `FirebaseAuthException`, `FirebaseException` 구분 처리
  - 상세 에러 메시지 표시
- macOS에서 이전 세션 정리 로직 추가

#### HomeScreen
- `onDaySelected()` 메서드 간소화 (setState만 사용)

#### Web 설정
- `web/index.html` 업데이트

---

## 5. `303a1af` [feat] add_ad_banner
**날짜**: 2025-12-27

### 변경된 파일
- `lib/component/banner_ad_widget.dart` (신규)
- `lib/component/banner_ad_widget_stub.dart` (신규)
- `lib/component/banner_ad_widget_web.dart` (신규)
- `lib/main.dart`
- `lib/screen/home_screen.dart`
- `pubspec.yaml` (의존성 추가)
- `android/app/src/main/AndroidManifest.xml`
- `ios/Runner/Info.plist`

### 주요 변경사항

#### BannerAdWidget (신규)
- **플랫폼별 광고 구현**
  - 웹: `HtmlElementView` 사용
  - 모바일: `google_mobile_ads` 패키지 사용
  - 조건부 import 사용 (`banner_ad_widget_stub.dart` / `banner_ad_widget_web.dart`)
- iOS/Android 테스트 광고 ID 사용
- 광고 로드 실패 시 dispose 처리

#### banner_ad_widget_stub.dart (신규)
- 모바일용 stub 파일

#### banner_ad_widget_web.dart (신규)
- 웹용 광고 초기화 함수

#### main.dart
- `BannerAdWidget` import 추가

#### home_screen.dart
- `BannerAdWidget` 추가 (구체적 위치는 diff 확인 필요)

#### 의존성 추가
- `google_mobile_ads` 패키지 추가

#### 플랫폼 설정
- Android: AndroidManifest.xml에 인터넷 권한 추가
- iOS: Info.plist에 광고 관련 설정 추가

---

## 6. `32640b8` [change] app_name
**날짜**: 2025-12-27

### 변경된 파일
- `pubspec.yaml`
- `android/app/build.gradle.kts`
- `android/app/src/main/kotlin/.../MainActivity.kt`
- `ios/Runner.xcodeproj/project.pbxproj`

### 주요 변경사항

#### 앱 이름 변경
- `pubspec.yaml`에서 앱 이름 변경
- Android: `build.gradle.kts`의 `applicationId` 및 패키지명 변경
- iOS: Xcode 프로젝트 설정에서 앱 이름 변경

---

## 요약

### 아키텍처 변경
1. **백엔드 전환**: Firestore → REST API → Firestore (혼재 상태)
2. **인증 시스템**: Google Sign-In 추가
3. **플랫폼 지원**: 웹, macOS 지원 강화

### 주요 기능 추가
1. Access Token 기반 인증
2. Google 로그인
3. 광고 배너 (플랫폼별 구현)
4. 전역 에러 핸들링

### 기술 스택 변경
- `cloud_firestore` → `dio` (일부)
- `google_sign_in` 추가
- `google_mobile_ads` 추가

### 플랫폼별 처리 강화
- 웹 플랫폼 지원
- macOS 특화 처리 (Firebase Auth persistence, Google Sign-In 세션 관리)
- Android/iOS 네이티브 설정 업데이트

